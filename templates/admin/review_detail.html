{% extends "admin/base.html" %}

{% block title %}Review: {{ recipe.name }}{% endblock %}

{% block content %}
<div class="flex items-center justify-between mb-6">
    <div>
        <a href="{{ url_for('admin.review_queue') }}" class="text-slate-500 hover:text-slate-700 text-sm">&larr; Back to Review Queue</a>
        <h1 class="text-2xl font-semibold text-slate-900 mt-1">{{ recipe.name }}</h1>
    </div>
</div>

<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- Main Content -->
    <div class="lg:col-span-2 space-y-6">
        <!-- Recipe Info -->
        <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-6">
            <h2 class="font-semibold text-slate-900 mb-4">Recipe Details</h2>

            <div class="grid grid-cols-2 gap-4 text-sm">
                <div>
                    <span class="text-slate-500">Source:</span>
                    <a href="{{ recipe.source }}" target="_blank" class="text-emerald-600 hover:underline ml-1">{{ recipe.source }}</a>
                </div>
                <div>
                    <span class="text-slate-500">Domain:</span>
                    <span class="ml-1">{{ recipe.domain or '-' }}</span>
                </div>
                <div>
                    <span class="text-slate-500">Language:</span>
                    <span class="ml-1">{{ recipe.language or '-' }}</span>
                </div>
                <div>
                    <span class="text-slate-500">Servings:</span>
                    <span class="ml-1">{{ recipe.servings }}</span>
                </div>
            </div>
        </div>

        <!-- Ingredients -->
        <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-6">
            <h2 class="font-semibold text-slate-900 mb-4">Ingredients ({{ recipe.ingredients|length }})</h2>

            <table class="w-full text-sm">
                <thead>
                    <tr class="text-left text-slate-500 border-b border-slate-100">
                        <th class="pb-2">Original</th>
                        <th class="pb-2">Matched</th>
                        <th class="pb-2 text-right">CO2</th>
                        <th class="pb-2">Source</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-slate-50">
                    {% for ing in recipe.ingredients %}
                    <tr>
                        <td class="py-2 text-slate-600">{{ ing.original_line or '-' }}</td>
                        <td class="py-2 font-medium">{{ ing.item }}</td>
                        <td class="py-2 text-right text-slate-600">{{ "%.3f"|format(ing.co2) }} kg</td>
                        <td class="py-2">
                            <span class="px-1.5 py-0.5 bg-slate-100 text-slate-600 rounded text-xs">{{ ing.source_db or '-' }}</span>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Original Ingredients -->
        {% if recipe.original_ingredients %}
        <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-6">
            <h2 class="font-semibold text-slate-900 mb-4">Original Text</h2>
            <pre class="text-sm text-slate-600 whitespace-pre-wrap font-mono bg-slate-50 p-4 rounded-lg">{{ recipe.original_ingredients }}</pre>
        </div>
        {% endif %}
    </div>

    <!-- Sidebar -->
    <div class="space-y-6">
        <!-- CO2 Summary -->
        <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-6">
            <div class="text-center">
                <div class="text-4xl font-bold
                    {% if recipe.co2_per_serving < 1.0 %}text-emerald-600
                    {% elif recipe.co2_per_serving < 1.8 %}text-amber-600
                    {% else %}text-rose-600{% endif %}">
                    {{ "%.2f"|format(recipe.co2_per_serving) }}
                </div>
                <div class="text-slate-500 text-sm">kg CO2 per serving</div>

                {% if recipe.rating %}
                <div class="mt-3 inline-block px-3 py-1 rounded-full text-sm font-medium
                    {% if recipe.rating.color == 'emerald' %}bg-emerald-100 text-emerald-800
                    {% elif recipe.rating.color == 'amber' %}bg-amber-100 text-amber-800
                    {% else %}bg-rose-100 text-rose-800{% endif %}">
                    {{ recipe.rating.label }}
                </div>
                {% endif %}
            </div>

            <div class="mt-4 pt-4 border-t border-slate-100 text-sm text-slate-600">
                <div class="flex justify-between">
                    <span>Total CO2:</span>
                    <span class="font-medium">{{ "%.2f"|format(recipe.total_co2) }} kg</span>
                </div>
            </div>
        </div>

        <!-- Nutrition -->
        {% if recipe.metadata and recipe.metadata.nutrition %}
        <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-6">
            <h3 class="font-semibold text-slate-900 mb-3">Nutrition (per serving)</h3>
            <div class="space-y-2 text-sm">
                <div class="flex justify-between">
                    <span class="text-slate-600">Calories</span>
                    <span class="font-medium">{{ recipe.metadata.nutrition.kcal|int }} kcal</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-slate-600">Protein</span>
                    <span class="font-medium">{{ recipe.metadata.nutrition.protein }} g</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-slate-600">Carbs</span>
                    <span class="font-medium">{{ recipe.metadata.nutrition.carbs }} g</span>
                </div>
                <div class="flex justify-between">
                    <span class="text-slate-600">Fat</span>
                    <span class="font-medium">{{ recipe.metadata.nutrition.fat }} g</span>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Actions -->
        <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-6">
            <h3 class="font-semibold text-slate-900 mb-4">Actions</h3>

            <div class="space-y-3">
                <a href="{{ url_for('edit', recipe_id=recipe.id) }}?publish=1"
                    class="block w-full bg-amber-500 text-white py-2 px-4 rounded-lg hover:bg-amber-600 font-medium text-center">
                    Edit & Publish
                </a>

                <form method="POST" action="{{ url_for('admin.approve_recipe', recipe_id=recipe.id) }}">
                    <button type="submit"
                        class="w-full bg-emerald-600 text-white py-2 px-4 rounded-lg hover:bg-emerald-700 font-medium">
                        Approve & Publish
                    </button>
                </form>

                <form method="POST" action="{{ url_for('admin.reject_recipe', recipe_id=recipe.id) }}"
                    onsubmit="return confirm('Delete this recipe? This cannot be undone.')">
                    <button type="submit"
                        class="w-full bg-white text-rose-600 border border-rose-200 py-2 px-4 rounded-lg hover:bg-rose-50 font-medium">
                        Reject & Delete
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}
